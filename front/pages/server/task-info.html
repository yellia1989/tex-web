<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>任务详情</title>
  <script type="text/javascript" src="/lib/loading/okLoading.js"></script>
  <link rel="stylesheet" href="/lib/layui/css/layui.css">
</head>

<body>
  <div id="show">
    <div class="layui-progress layui-progress-big" lay-filter="p" lay-showPercent="true">
      <div class="layui-progress-bar layui-bg-red" lay-percent="0%"></div>
    </div>

  </div>

  <script src="/lib/layui/layui.js"></script>
  <script>
    layui.use(["okUtils", "okLayer", "util", "element"], function () {
      let $ = layui.jquery;
      let okUtils = layui.okUtils;
      let okLayer = layui.okLayer;
      let util = layui.util;
      let element = layui.element;
      okLoading.close();

      function createElement(name, value) {
        return '<li><div class="layui-menu-body-title">' + name + ': ' + value + '</div></li>';
      }
      function updateShow(data) {
        let d = $("#show");
        let val = '<div class="layui-panel"> <ul class="layui-menu">';
        val += createElement("状态", data["iStatus"]);
        val += createElement("创建时间", data["iCreateTime"]);
        val += '<li class="layui-menu-item-group layui-menu-item-down" lay-options="{type: "group"}"> <div class="layui-menu-body-title"> 子任务列表 </div> <ul>';
        // 多个子任务
        let vSubTask = data["vItem"];
        for (let v of vSubTask) {
          val += createElement("状态", v["iStatus"]);
          val += createElement("开始时间", v["iStartTime"]);
          val += createElement("耗时", v["iEndTime"] - v["iStartTime"]);
          val += createElement("结果", v["sResult"]);
          val += createElement("百分比", v["iPercent"]);
        }
        val += '</ul></li>';

        val += '</ul></div>';

        d.html(val);
      }
      function code() {
        okUtils.ajax("/api/server/getTask", "get", { taskNo: parent.taskNo }, false).done(function (response) {
          updateShow(response.data)
          setTimeout(code, 1000);
        }).fail(function (error) {
          okLayer.redCrossMsg(error.msg);
        });
      };
      code();

    });
  </script>

</body>

</html>
